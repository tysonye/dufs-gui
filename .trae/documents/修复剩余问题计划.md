## 剩余问题修复计划

### 1. 服务路径特殊字符处理（高风险）

**问题**：在`_build_command`方法中，服务路径直接添加到命令列表，未处理特殊字符
**修复方案**：

```python
# 在_build_command方法中
import shlex
service_path = service_serve_path
command.append(service_path)  # subprocess列表模式会自动处理空格，但shlex.quote更安全
```

### 2. 日志线程未正确终止（中等风险）

**问题**：服务停止后，日志读取线程可能仍在运行
**修复方案**：

```python
# 在stop_service方法中添加
if hasattr(service, 'log_thread_terminate'):
    service.log_thread_terminate = True
```

### 3. 服务路径未规范化（中等风险）

**问题**：未处理相对路径、符号链接等
**修复方案**：

```python
# 在服务创建和编辑时规范化路径
service.serve_path = os.path.abspath(service.serve_path)
```

### 4. 认证规则处理不安全（中等风险）

**问题**：直接使用service.auth\_rules，未检查是否为列表类型
**修复方案**：

```python
# 在_build_command方法中
if service.auth_rules and isinstance(service.auth_rules, list) and len(service.auth_rules) > 0:
    for rule in service.auth_rules:
        # 处理认证规则
```

### 5. 服务状态管理线程安全问题（潜在风险）

**问题**：monitor\_service中释放锁后调用process.poll()，存在竞态条件
**修复方案**：

```python
# 在monitor_service方法中
with service.lock:
    if not service.running or service.process is None:
        break
    # 在锁内检查进程状态
    poll_result = service.process.poll()
```

### 6. 服务路径检查不完整（低风险）

**问题**：未检查服务路径是否为目录
**修复方案**：

```python
# 在_start_service_process方法中
if not os.path.isdir(service.serve_path):
    QMessageBox.critical(self, "错误", f"服务路径必须是目录\n路径: {service.serve_path}")
    return False
```

